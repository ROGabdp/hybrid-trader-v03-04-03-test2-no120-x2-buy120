# v03-04-03-test2-no120-x2-buy120 é‡é»

åŸºæ–¼ v03-04-03-test2-no120 ç‰ˆæœ¬ä¿®æ”¹ï¼Œä¸»è¦ä¿®æ”¹: 

1.buy agentè¨“ç·´æ™‚ï¼Œç›®æ¨™æ”¹ç‚ºè²·å…¥120å¤©å…§ä¸Šæ¼²è¶…é10%ã€‚æ–°å¢ Next_120d_Max è¨ˆç®— - åœ¨ calculate_features() ä¸­è¨ˆç®— 120 å¤©å…§æœ€é«˜é»å ±é…¬ç‡
2.ç§»é™¤å”å…¶å®‰é€šé“é™åˆ¶ - BuyEnvHybrid.__init__() ä¸å†åªçœ‹çªç ´æ—¥ï¼Œæ”¹ç‚ºæ‰€æœ‰äº¤æ˜“æ—¥éƒ½å¯è²·å…¥
3.ä¿®æ­£æ¸¬è©¦é›†å…§æ¨£æœ¬å¹³è¡¡çš„éŒ¯èª¤ï¼Œå…ˆå‰100% åªæœƒæŠ½å–è² æ¨£æœ¬ï¼Œæ¸¬è©¦å‡ºä¾†çš„åˆ†æ•¸æ°¸é éƒ½æ˜¯ -0.5
4.ä¿®æ­£ Next_120d_Max çš„è¨ˆç®—é‚è¼¯: åŸå§‹å…¬å¼ shift(-N).rolling(N).max() è¨ˆç®—çš„æ˜¯ã€Œå¾ T+N å¾€å›çœ‹ N å¤©ã€ï¼Œè€Œéã€Œå¾ T+1 åˆ° T+N é€™ N å¤©ã€çš„æœ€é«˜åƒ¹ã€‚

# Buy Agent è©•ä¼°çµæœåˆ†æ
é—œéµç™¼ç¾ï¼š

æŒ‡æ¨™	æ•¸å€¼
æ¸¬è©¦æœŸé–“	2017-10-16 ~ 2025-12-26 (2000 å¤©)
è²·å…¥æ±ºç­–	100% (2000/2000) - Agent æ°¸é é¸æ“‡è²·å…¥
è²·å…¥æˆåŠŸç‡	50.1% (1002/1999)
Next_120d_Max_Return å¹³å‡å€¼	12.5%
>=10% æ¯”ä¾‹	~50% (ä¸­ä½æ•¸ 10.0%)
å•é¡Œåˆ†æï¼š

Agent æ°¸é é¸æ“‡è²·å…¥ - é€™èªªæ˜æ¨¡å‹æ²’æœ‰å­¸æœƒã€Œä¸è²·ã€çš„ç­–ç•¥ï¼Œå¯èƒ½æ˜¯å› ç‚ºï¼š
è¨“ç·´æ¨£æœ¬ä¸­æ­£æ¨£æœ¬æ¯”ä¾‹å¤ªé«˜ (ç´„ 47%)ï¼ŒåŠ ä¸Š 50/50 å¹³è¡¡æ¡æ¨£è®“æ¨¡å‹åå‘è²·å…¥
è²·å…¥æ­£ç¢ºçš„çå‹µ (+2.0) å¤§æ–¼ä¸è²·æ­£ç¢ºçš„çå‹µ (+0.5)
æ¨¡å‹å¯èƒ½éåº¦å­¸ç¿’åˆ°ã€Œè²·å°±å°äº†ã€çš„ç­–ç•¥
50.1% æˆåŠŸç‡æ¥è¿‘éš¨æ©Ÿ - å› ç‚º 120 å¤©å…§æœ‰ ~47% çš„æ©Ÿæœƒæ¼²è¶…é 10%ï¼Œæ¨¡å‹æ°¸é è²·å…¥çš„ç­–ç•¥åªæ˜¯ç•¥å„ªæ–¼éš¨æ©Ÿ



# v03-04-03-test2-no120-x2 é‡é»

åŸºæ–¼ v03-04-03-test2-no120 ç‰ˆæœ¬ä¿®æ”¹ï¼Œä¸»è¦æ–°å¢å…©å¤§åŠŸèƒ½ï¼š

## 1. âœ¨ å‹•æ…‹è³‡é‡‘é…ç½® (Dynamic Fund Allocation) - Strat 1 & 2

**å•é¡Œ**ï¼šåŸå§‹ Shared Pool æ¨¡å¼ä¸­ï¼ŒAI è³£å‡ºçš„è³‡é‡‘åªæ˜¯å›åˆ° `internal_cash`ï¼Œä¸æœƒå¢åŠ å¾ŒçºŒçš„ DCA/AI è²·å…¥é‡‘é¡ï¼Œå°è‡´å¹´åº•æœ‰é–’ç½®è³‡é‡‘ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šæ¯æœˆè²·å…¥é‡‘é¡å‹•æ…‹è¨ˆç®— (é©ç”¨æ–¼ Strat 1 & 2)

```python
# æ¯å¹´åˆæ³¨å…¥è³‡é‡‘
yearly_pool += yearly_capital  # 60 è¬

# AI è³£å‡ºæ™‚
yearly_pool += leveraged_value  # æ”¶ç›Šå›åˆ°æ± ä¸­

# æ¯æœˆåˆè¨ˆç®—è²·å…¥é‡‘é¡
remaining_months = 13 - month  # 1æœˆ=12å€‹æœˆ, 12æœˆ=1å€‹æœˆ
dynamic_chunk_amount = yearly_pool / remaining_months
```

**æ•ˆæœ**ï¼š
| æ™‚é–“é» | Pool é‡‘é¡ | æ¯å€‰é‡‘é¡ | èªªæ˜ |
|--------|-----------|----------|------|
| 2020 å¹´åˆ | $600,000 | $50,000 | æ¨™æº–é…ç½® |
| 2022 å¹´åˆ | $1,091,762 | **$90,980** | AI è³£å‡ºç´¯ç©è³‡é‡‘ |
| 2024 å¹´åˆ | $1,091,085 | **$90,924** | è¤‡åˆ©æ•ˆæ‡‰ |

---

## 2. âš¡ å¤§è·Œæ™‚ 2x æ§“æ¡¿ (Strat 1 Only)

**è§¸ç™¼æ¢ä»¶**ï¼šç•¶å¤§ç›¤å¾æ­·å²é«˜é»ä¸‹è·Œè¶…é **8%** (èˆ‡åœæé»ä¸€è‡´)

**é‹ä½œé‚è¼¯**ï¼š
- é€²å…¥ 2x æ¨¡å¼å¾Œï¼Œ**æ‰€æœ‰æ–°è²·å…¥çš„å€‰ä½** (DCA + AI) æ¼²è·Œå¹…ä»¥ 2 å€è¨ˆç®—
- ç•¶å¤§ç›¤**æ¼²å›åˆ°å•Ÿå‹• 2x æ™‚çš„åƒ¹æ ¼**ï¼Œé€€å‡ºæ§“æ¡¿æ¨¡å¼
- å·²è²·å…¥çš„ 2x å€‰ä½**ç¶­æŒæ§“æ¡¿ç›´åˆ°è³£å‡º**

```python
LEVERAGE_THRESHOLD = 0.08  # ä¸‹è·Œ 8% å•Ÿå‹•æ§“æ¡¿

# è§¸ç™¼æ¢ä»¶
if price < peak_price * (1 - LEVERAGE_THRESHOLD):
    leveraged_mode = True
    leverage_trigger_price = price

# é€€å‡ºæ¢ä»¶
if price >= leverage_trigger_price:
    leveraged_mode = False
```

**æ§“æ¡¿äº‹ä»¶çµ±è¨ˆ** (2020-2025)ï¼šå…± 12 æ¬¡å•Ÿå‹•

| å•Ÿå‹•æ—¥æœŸ | çµæŸæ—¥æœŸ | è§¸ç™¼åƒ¹æ ¼ | è·Œå¹… |
|----------|----------|----------|------|
| 2020-03-02 | 2020-03-03 | 11,170 | -8.3% |
| 2020-03-12 (COVID) | 2020-04-15 | 10,422 | -9.5% |
| 2022-09-23 | 2022-11-14 | 14,118 | -8.7% |
| ... | ... | ... | ... |

---

## 3. ğŸ¯ Benchmark æ ¡æº– (Pure DCA Optimization)

**å•é¡Œ**ï¼šPure DCA æ¯æœˆå›ºå®šè²·å…¥ $50,000ï¼Œæœƒå› ç‚ºè‚¡åƒ¹ç„¡æ³•æ•´é™¤è€Œç”¢ç”Ÿé›¶é ­ (e.g. å‰© $6,000)ï¼Œé•·æœŸç´¯ç©å°è‡´ç¸½æŠ•å…¥é‡‘é¡æ¯” Yearly Lump å°‘äº†ç´„ 15%ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æ¯å¹´ 12 æœˆåº•ï¼Œè‡ªå‹•å°‡ç´¯ç©çš„é›¶é ­ç¾é‡‘ä¸€æ¬¡è²·å…¥ã€‚
- **æ•ˆæœ**ï¼šèˆ‡ Yearly Lump çš„ç¸½æŠ•å…¥å·®è·ç¸®å°è‡³ **0.25%**ï¼Œæ¯”è¼ƒåŸºç¤æ›´å…¬å¹³ã€‚

---

## 4. ğŸ“Š æœ€çµ‚ç¸¾æ•ˆå°æ¯” (2020-2025)

**æ‰€æœ‰ç­–ç•¥è³‡é‡‘é‹ç”¨æ•ˆç‡ä¸€è‡´åŒ–**ï¼šç¸½æŠ•å…¥çš†ç‚º ~$3.6M

| ç­–ç•¥ | æŠ•å…¥è³‡é‡‘ | æœ€çµ‚å¸‚å€¼ | **ç¸½å ±é…¬ç‡** | å¹´åŒ–å ±é…¬ | Max DD |
|------|----------|----------|-------------|----------|--------|
| **Strat 1 (Dynamic + 2x)** | **$3,600,000** | **$7,094,794** ğŸ† | **+97.08%** | **12.02%** | -29.8% |
| Strat 2 (Shared Pool) | **$3,600,000** | $6,107,058 | +69.64% | 9.25% | -27.3% |
| Yearly Lump | $3,553,882 | $6,249,220 | +75.84% | 9.91% | -31.6% |
| Pure DCA | $3,544,895 | $5,967,723 | +68.35% | 9.11% | -25.2% |

### ğŸ† é—œéµçµè«–

1. **Strat 1 å¤§å‹ Yearly Lump**ï¼š
   - æœ€çµ‚å¸‚å€¼é«˜å‡º **$84.5 è¬** (+13.5%)
   - é›–ç„¶ Max DD ç•¥é«˜ï¼Œä½†å ±é…¬ç‡å®Œå…¨è£œå„Ÿäº†é¢¨éšªã€‚
   
2. **æ§“æ¡¿æ•ˆæœé¡¯è‘—**ï¼š
   - Strat 1 (æœ‰æ§“æ¡¿) æ¯” Strat 2 (ç„¡æ§“æ¡¿) å¤šè³ºäº† **$98.7 è¬**ï¼Œé€™å®Œå…¨æ­¸åŠŸæ–¼ 12 æ¬¡çš„å¤§è·Œ 2x æŠ„åº•æ“ä½œã€‚

---

## 4. ä¿®æ”¹çš„æª”æ¡ˆ

| æª”æ¡ˆ | ä¿®æ”¹å…§å®¹ |
|------|----------|
| `backtest_v4_dca_hybrid_with_filter_fixed_lstm.py` | æ–°å¢ `LeveragedSharedPoolBacktester` é¡åˆ¥å–ä»£ `DCAHybridBacktester` |

**ä¸»è¦ç¨‹å¼ç¢¼è®Šæ›´**ï¼š
- ç¬¬ 347-670 è¡Œï¼šæ–°çš„ `LeveragedSharedPoolBacktester` é¡åˆ¥
- å‹•æ…‹è³‡é‡‘é…ç½®ï¼š`yearly_pool` è®Šæ•¸å–ä»£ `external_limit + internal_cash`
- æ§“æ¡¿è¿½è¹¤ï¼š`leverage_events`, `leverage_periods` è¨˜éŒ„
- æ–°å¢è¼¸å‡ºæª”æ¡ˆï¼š`leverage_events_strat1_*.csv`, `daily_action_strat1_*.csv`

---

## 5. ä½¿ç”¨æ–¹å¼

```bash
# åŸ·è¡Œå›æ¸¬ï¼ˆé è¨­å¾ 2020-01-01 é–‹å§‹ï¼‰
python backtest_v4_dca_hybrid_with_filter_fixed_lstm.py --start 2020-01-01

# æŒ‡å®šçµæŸæ—¥æœŸ
python backtest_v4_dca_hybrid_with_filter_fixed_lstm.py --start 2020-01-01 --end 2024-12-31
```

**è¼¸å‡ºæª”æ¡ˆ**ï¼š
```
results_backtest_v4_dca_hybrid_with_filter_fixed_lstm/
â”œâ”€â”€ metrics_comparison_*.csv          # ç­–ç•¥ç¸¾æ•ˆå°æ¯”
â”œâ”€â”€ leverage_events_strat1_*.csv      # æ§“æ¡¿å•Ÿå‹•/çµæŸäº‹ä»¶
â”œâ”€â”€ daily_action_strat1_*.csv         # æ¯æ—¥æ“ä½œ (å«æ§“æ¡¿ç‹€æ…‹)
â”œâ”€â”€ daily_timeline_strat1_*.png       # æ™‚é–“ç·šåœ– (æ¨™ç¤º 2x æœŸé–“)
â””â”€â”€ backtest_comparison_*.png         # æ¬Šç›Šæ›²ç·šå°æ¯”åœ–
```

## 6. ğŸ‘ï¸ ç›¤ä¸­/ç›¤å¾Œç›£æ§å‡ç´š (Daily/Intraday Ops)

**åŠŸèƒ½**ï¼šåœ¨ç›¤å¾Œ (`daily_ops_v4_fixed_lstm.py`) èˆ‡ç›¤ä¸­ (`daily_ops_v4_intraday_fixed_lstm.py`) å ±å‘Šä¸­ï¼ŒåŒæ­¥é¡¯ç¤º Strategy 1 çš„ 2x æ§“æ¡¿ç‹€æ…‹ã€‚

**é¡¯ç¤ºè³‡è¨Š**ï¼š
- **æ§“æ¡¿ç‹€æ…‹**ï¼š`ğŸ”¥ ON (2x)` æˆ– `â„ï¸ OFF (1x)`
- **æ­·å²é«˜é» (Peak)**ï¼šç›®å‰è¿½è¹¤çš„æœ€é«˜åƒ¹ (Strategy 1 é‚è¼¯)
- **è§¸ç™¼/é€€å‡ºé»ä½**ï¼š
  - æœªå•Ÿå‹•æ™‚ï¼šé¡¯ç¤ºè§¸ç™¼åƒ¹ (Peak * 92%) èˆ‡è·é›¢
  - å·²å•Ÿå‹•æ™‚ï¼šé¡¯ç¤ºé€€å‡ºåƒ¹ (Peak) èˆ‡è·é›¢

**ç¯„ä¾‹è¼¸å‡º**ï¼š
```text
âš¡ [2x æ§“æ¡¿ç›£æ§] (Strategy 1)
   ç‹€æ…‹: ğŸ”¥ ON (2å€æ§“æ¡¿)
   é«˜é»: 28,400.73 | ç›®å‰è·Œå¹…: -10.50%
   é€€å‡º: 28,400.73 (å›åˆ°é«˜é»å³é€€å‡º)
```


# v03-04-03-test2-no120 é‡é»

åŸºæ–¼ v03-04-03-test2 ç‰ˆæœ¬ä¿®æ”¹ï¼Œä¸»è¦è®Šæ›´ï¼š**ç§»é™¤ 120 å¤©å¼·åˆ¶è³£å‡ºé™åˆ¶** + **é‡æ–°è¨­è¨ˆ Sell Agent çå‹µæ©Ÿåˆ¶**ã€‚

## 1. ç§»é™¤ 120 å¤©å¼·åˆ¶è³£å‡ºé™åˆ¶

**å•é¡Œ**ï¼šåŸå§‹ Sell Agent æœƒåœ¨æŒæœ‰ 120 å¤©å¾Œå¼·åˆ¶è³£å‡ºï¼Œä¸è«– AI åˆ¤æ–·æˆ–å¸‚å ´ç‹€æ³ã€‚

**ä¿®æ”¹å…§å®¹**ï¼šå¾æ‰€æœ‰å›æ¸¬è…³æœ¬ä¸­ç§»é™¤ `hold_days >= 120` æ¢ä»¶ï¼š

| æª”æ¡ˆ | ä¿®æ”¹ä½ç½® |
|------|----------|
| `backtest_v4_dca_hybrid_with_filter_rolling_lstm.py` | ç¬¬ 300, 494 è¡Œ |
| `backtest_v4_dca_hybrid_with_filter_fixed_lstm.py` | ç¬¬ 436, 638 è¡Œ |
| `backtest_v4_with_filter.py` | ç¬¬ 160-177 è¡Œ |
| `backtest_v4_with_filter_rolling_lstm.py` | ç¬¬ 254-271 è¡Œ |
| `backtest_v4_dca_hybrid_no_filter.py` | ç¬¬ 198, 368 è¡Œ |
| `backtest_v4_dca_hybrid_no_filter_rolling_lstm.py` | ç¬¬ 296, 480 è¡Œ |
| `backtest_v4_no_filter.py` | ç¬¬ 151-168 è¡Œ |
| `backtest_v4_no_filter_rolling_lstm.py` | ç¬¬ 261-276 è¡Œ |
| `ptrl_hybrid_system.py` (`HybridBacktester`) | ç¬¬ 1032 è¡Œ |

**ä¿®æ”¹å¾Œ**ï¼šSell Agent åªæœƒåœ¨ä»¥ä¸‹æ¢ä»¶è³£å‡ºï¼š
- AI åˆ¤æ–·è³£å‡º (`action[0] == 1`)
- åœæ -8% (`current_return < 0.92`)

---

## 2. Sell Agent çå‹µæ©Ÿåˆ¶é‡æ–°è¨­è¨ˆ (Plan C)

**å•é¡Œ**ï¼šåŸå§‹çå‹µæ©Ÿåˆ¶å°è‡´ Agent å­¸æœƒã€Œæ°¸é ä¸è³£ã€ã€‚

**æ–°çš„çå‹µé‚è¼¯** (`SellEnvHybrid.step()`)ï¼š

```python
if action == 1 or self.day >= 119:  # è³£å‡º
    # 1. åŸºç¤çå‹µï¼šç•¶å‰å ±é…¬ (ç²åˆ© 10% = +1.0)
    base_reward = (current_return - 1.0) * 10
    
    # 2. éŒ¯éé«˜é»æ‡²ç½° / è³£åœ¨é«˜é»çå‹µ
    if future_max > current_return + 0.01:  # æœªä¾†é‚„æœƒæ¼² >1%
        penalty = (future_max - current_return) * 2
    else:
        penalty = -0.5  # è³£åœ¨é«˜é»ï¼çå‹µ
    
    # 3. èº²éå¤§è·Œçå‹µ
    if future_min < current_return - 0.05:  # æœªä¾†æœƒè·Œ >5%
        bonus = (current_return - future_min) * 5
    else:
        bonus = 0
    
    reward = base_reward - penalty + bonus

else:  # æŒæœ‰
    # å‹•æ…‹æŒæœ‰æ‡²ç½°ï¼ˆæº«å’Œç‰ˆï¼‰
    if current_return >= 1.10:    # å·²ç²åˆ© â‰¥10%
        reward = -0.01            # è¼•å¾®æ‡²ç½°
    elif current_return >= 1.05:  # ç²åˆ© 5-10%
        reward = -0.002           # éå¸¸è¼•å¾®
    else:                          # <5% æˆ–è™§æ
        reward = 0.0              # ä¸æ‡²ç½°
```

**è¨­è¨ˆç›®æ¨™**ï¼š
- âœ… è³£åœ¨é«˜é»ï¼šéŒ¯éæ¼²å¹…æœƒè¢«æ‡²ç½°ï¼Œè³£åœ¨æœ€é«˜é»æœ‰é¡å¤–çå‹µ
- âœ… èº²éå¤§è·Œï¼šè³£å‡ºå¾Œè‚¡åƒ¹å¤§è·Œæœƒç²å¾—é¡å¤–çå‹µ
- âœ… å‹•æ…‹æŒæœ‰æˆæœ¬ï¼šç²åˆ©è¶Šå¤šï¼ŒæŒæœ‰æ‡²ç½°è¶Šé‡ï¼Œé¼“å‹µé©æ™‚è³£å‡º

---

## 3. ç¸¾æ•ˆè¡¨ç¾ (backtest_v4_with_filter)

| æŒ‡æ¨™ | æ•¸å€¼ | è©•åƒ¹ |
|------|------|------|
| ç¸½äº¤æ˜“æ¬¡æ•¸ | 7 ç­† | âœ… åˆç† |
| å¹³å‡æŒæœ‰å¤©æ•¸ | **77 å¤©** | âœ… èƒ½æŠ“ä½æ³¢æ®µ |
| å¹³å‡å ±é…¬ç‡ | **+10.36%** | âœ… å„ªç§€ |
| å‹ç‡ | **85.7%** (6/7) | âœ… éå¸¸å¥½ |

**äº¤æ˜“æ˜ç´°**ï¼š
| è²·å…¥æ—¥ | è³£å‡ºæ—¥ | å ±é…¬ç‡ | æŒæœ‰å¤©æ•¸ |
|--------|--------|--------|---------|
| 2023-01-09 | 2024-04-08 | +38.4% ğŸŒŸ | 294 |
| 2024-04-09 | 2024-06-18 | +9.4% | 48 |
| 2024-08-19 | 2024-08-20 | +0.09% | 1 |
| 2024-09-19 | 2024-10-21 | +6.8% | 19 |
| 2024-12-04 | 2025-03-31 | -11.0% âŒ | 74 |
| 2025-04-28 | 2025-09-15 | +26.6% ğŸŒŸ | 98 |
| 2025-09-16 | 2025-09-24 | +2.2% | 6 |

---

## 4. è¨“ç·´è¨­å®š

```python
PRETRAIN_SELL_STEPS = 500_000
FINETUNE_SELL_STEPS = 500_000  # æœ€ä½³é»ç´„åœ¨ 450K
```

**TensorBoard è§€å¯Ÿ**ï¼š
- Fine-tune eval åœ¨ ~450K é”åˆ°å³°å€¼å¾Œä¸‹é™ (éæ“¬åˆ)
- EvalCallback å·²ä¿å­˜æœ€ä½³æ¨¡å‹

---

# v03-04-03-test2é‡é» (ç›®å‰ç¸¾æ•ˆæœ€å¥½ç‰ˆæœ¬)

æ²¿ç”¨:
- ç”±å‰ä¸€ç‰ˆ v03-04-03 å‡ç´šï¼Œæ²¿ç”¨è¼ƒç©æ¥µçš„buy agentï¼Œæ˜¯è¿½æ±‚ç²åˆ©çš„ç‰ˆæœ¬ã€‚ 
- æ²¿ç”¨å…ˆå‰çš„ fixed_lstm æ¯æ—¥å›æ¸¬å’Œç›¤ä¸­è§€æ¸¬AIå¯èƒ½äº¤æ˜“æ¨¡å¼ï¼Œä¸¦è‡¨æ‘¹ä¹‹ã€‚

æ›´æ–°
- ç¨ç«‹ Agent æª¢æŸ¥ï¼šBuy å’Œ Sell æ¨¡å‹åˆ†é–‹æª¢æŸ¥æ˜¯å¦å­˜åœ¨
- ä½¿ç”¨æœ€ä½³æ¨¡å‹ï¼šè¨“ç·´çµæŸå¾Œè¤‡è£½ best_model.zip ç‚º base.zip / final.zip
- é€™å€‹ç‰ˆæœ¬ä¸»è¦ å¢åŠ  KD/ MACD åˆ°RLçš„è¨“ç·´ç•¶ä¸­ï¼Œä¸¦ç§»é™¤T+20å’Œå…¶ä¿¡å¿ƒ ç‰¹å¾µ

ç¸¾æ•ˆ  (ä»¥backtest_v4_with_filterå›æ¸¬ V03-04-03-test2):
æ ¸å¿ƒç¸¾æ•ˆæŒ‡æ¨™
æŒ‡æ¨™	    V4 With Filter	   Buy & Hold	   å„ªå‹¢
ç¸½å ±é…¬ç‡	+103.9%	            +93.6%	     âœ… +10.3%
å¹´åŒ–å ±é…¬ç‡	27.3%	            25.1%	       âœ… +2.2%
å¤æ™®æ¯”ç‡	1.84	              1.17	       âœ… +57% é¢¨éšªèª¿æ•´å ±é…¬
æœ€å¤§å›æ’¤	-13.4%	            -28.7%	     âœ… å›æ’¤æ¸›å°‘ 53%

ğŸ“ˆ äº¤æ˜“çµ±è¨ˆ
æŒ‡æ¨™	           æ•¸å€¼
äº¤æ˜“æ¬¡æ•¸	       5 ç­†
å‹ç‡	          100% (5/5)
å¹³å‡å ±é…¬	      +17.7%
å¹³å‡æŒæœ‰å¤©æ•¸	  120 å¤©
è¢«éæ¿¾æ¬¡æ•¸	    68 æ¬¡

ğŸ“Š ä¸‰ç‰ˆæœ¬ç¸¾æ•ˆæ¯”è¼ƒ (V03-03 â†’ V03-04-03 â†’ V03-04-03-test2)

æŒ‡æ¨™	   V03-03	  V03-04-03	V03-04-03-test2	   æœ€ä½³ç‰ˆæœ¬
ç¸½å ±é…¬ç‡	+66.2%	+74.7%	   +103.9%	  ğŸ† V03-04-03-test2  
å¹´åŒ–å ±é…¬ç‡	18.8%	 20.9%	   27.3%	    ğŸ† V03-04-03-test2
å¤æ™®æ¯”ç‡	 1.25	   1.48	     1.84	      ğŸ† V03-04-03-test2
æœ€å¤§å›æ’¤	-17.1%	-17.3%	  -13.4%	    ğŸ† V03-04-03-test2
å‹ç‡	     80%	  80%	      100%  	    ğŸ† V03-04-03-test2
å¹³å‡å ±é…¬	 +12.9%	+14.4%	  +17.7%	    ğŸ† V03-04-03-test2
å¹³å‡æŒæœ‰å¤©æ•¸	106	  111	     120	        -
è¢«éæ¿¾æ¬¡æ•¸	 15	    64	       68	        -

ğŸ“ˆ ç‰ˆæœ¬æ¼”é€²è¶¨å‹¢
ç¸½å ±é…¬ç‡ï¼š66.2% â†’ 74.7% â†’ 103.9%  (æŒçºŒä¸Šå‡ â†‘)
å¤æ™®æ¯”ç‡ï¼š1.25 â†’ 1.48 â†’ 1.84     (æŒçºŒä¸Šå‡ â†‘)
æœ€å¤§å›æ’¤ï¼š-17.1% â†’ -17.3% â†’ -13.4% (ç¬¬ä¸‰ç‰ˆæ˜é¡¯æ”¹å–„)
å‹ç‡ï¼š   80% â†’ 80% â†’ 100%        (ç¬¬ä¸‰ç‰ˆçªç ´)

âœ¨ é—œéµæ”¹é€²åˆ†æ
ç‰ˆæœ¬å‡ç´š	ä¸»è¦æ”¹é€²	å ±é…¬å¢åŠ 
V03-03 â†’ V03-04-03	æ›´ç©æ¥µçš„ Buy Agent & 	æ–°å¢ KD/MACD ç‰¹å¾µ +8.5%
V03-04-03 â†’ V03-04-03-test2	ç§»é™¤T+20å’Œå…¶ä¿¡å¿ƒ ç‰¹å¾µ	+29.2%
ç´¯è¨ˆæ”¹é€²		+37.7%

ğŸ¯ çµè«–
V03-04-03-test2 æ˜¯ç›®å‰æœ€ä½³ç‰ˆæœ¬ï¼š

å ±é…¬æœ€é«˜ (+103.9%)
é¢¨éšªæœ€ä½ (å›æ’¤ -13.4%)
å‹ç‡æœ€é«˜ (100%)
æ¯ç­†äº¤æ˜“è³ºæœ€å¤š (+17.7%)

ç§»é™¤T+20å’Œå…¶ä¿¡å¿ƒ ç‰¹å¾µçš„æ•ˆæœéå¸¸é¡¯è‘—ï¼Œè®“buy agentä¸æœƒéåº¦ä¿å®ˆï¼Œå¸¶ä¾†äº†ç´„ 30% çš„å ±é…¬æå‡ï¼

Note:
- V4: è¨“ç·´æ­¥æ•¸è¨­å®š
PRETRAIN_BUY_STEPS = 1_000_000
PRETRAIN_SELL_STEPS = 500_000
FINETUNE_BUY_STEPS = 1_000_000
FINETUNE_SELL_STEPS = 500_000

- æœ€ä½³æ¨¡å‹æ­¥æ•¸: ä»¥ä¸‹æ˜¯å¾ TensorBoard äº‹ä»¶æª”æ¡ˆä¸­è®€å–çš„ ç²¾ç¢ºæœ€ä½³æ­¥æ•¸
buy: 184è¬æ­¥
sell: 92è¬æ­¥

Agent	 éšæ®µ	      æœ€ä½³æ­¥æ•¸	 æœ€ä½³ Reward	 è©•ä¼°æ¬¡æ•¸
Buy	   Pre-train	560,000	  0.36	        12 æ¬¡
Buy	   Fine-tune	1,280,000	0.03	        25 æ¬¡
Sell	 Pre-train	160,000	  53.50	        6 æ¬¡
Sell	 Fine-tune	320,000	  51.30	        12 æ¬¡

æ ¹æ“šä»¥ä¸Šæ•¸æ“šï¼Œæœ€ä½³æ¨¡å‹å‡ºç¾çš„ä½ç½®ï¼š
Agent	 éšæ®µ	       å»ºè­°è¨­å®š
Buy	   Pre-train	 600,000 (æœ€ä½³åœ¨ 560K)
Buy	   Fine-tune	 300,000 (æœ€ä½³åœ¨ Fine-tune ç¬¬ 280K)
Sell	 Pre-train	 200,000 (æœ€ä½³åœ¨ 160K)
Sell	 Fine-tune	 350,000 (æœ€ä½³åœ¨ 320K)

- æ­£è¦åŒ–æ–¹å¼
ç‰¹å¾µ	       æ­£è¦åŒ–æ–¹æ³•	   æœ€çµ‚å‘½å
K (9,3)	     / 100.0	   Norm_K
D (9,3)	     / 100.0	   Norm_D
DIF (12-26)	 / Close	   Norm_DIF
MACD9	      / Close	     Norm_MACD
OSC	        / Close	     Norm_OSC



# æ²¿ç”¨ v03-04 å¯ä»¥è®€å– å›æ¸¬æŒå€‰ç‹€æ…‹ çš„ ç›¤ä¸­daily_ops_v4_intraday_fixed_lstm.pyï¼Œä¸”æ¡ç”¨äº†å›ºå®šçš„LSTM  backtest_v4_dca_hybrid_with_filter_fixed_lstm.py ä»¥ç¢ºä¿æ¯æ—¥å›æ¸¬çš„çµæœä¸€è‡´ã€‚å› æ­¤å»ºè­°çš„æ“ä½œæµç¨‹ç°¡åŒ–å¦‚ä¸‹:
      ğŸ“… æ¯æ—¥ä¾‹è¡Œå…¬äº‹
      ğŸŒ™ ç›¤å¾Œï¼ˆæ”¶ç›¤å¾ŒåŸ·è¡Œï¼‰
      
      # Step 1: åŸ·è¡Œå›æ¸¬ (æ›´æ–°æŒå€‰åˆ°ä»Šå¤©)
      python backtest_v4_dca_hybrid_with_filter_fixed_lstm.py --start 2025-12-09
      
      é€™æœƒï¼š
      ä¸‹è¼‰æœ€æ–°è‚¡åƒ¹è³‡æ–™
      ç”¨å›ºå®š LSTM åŸ·è¡Œå›æ¸¬
      è¼¸å‡ºä»Šæ—¥çš„æŒå€‰ç‹€æ…‹å’Œæ“ä½œå»ºè­°
      æ›´æ–° open_positions_strat2_*.csvï¼ˆä½ çš„ AI æŒå€‰æ˜ç´°ï¼‰

      # Step 2: åŸ·è¡Œ daily_ops_ç›¤å¾Œ (åŸºæ–¼æœ€æ–°æŒå€‰åˆ¤æ–·)
      (è‡ªå‹•é¸æ“‡æœ€æ–°çš„å›æ¸¬æª”æ¡ˆ)
      python daily_ops_v4_fixed_lstm.py
      
      ğŸ¯ å¦‚ä½•æŒ‡å®šç‰¹å®šå›æ¸¬ï¼Ÿ
      æ–¹æ³• 1ï¼šä½¿ç”¨äº’å‹•æ¨¡å¼
      python daily_ops_v4_fixed_lstm.py --interactive

      æ–¹æ³• 2ï¼šæŒ‡å®šå›æ¸¬é–‹å§‹æ—¥æœŸ
      python daily_ops_v4_fixed_lstm.py --backtest-start 2025-12-09

      
      â˜€ï¸ éš”å¤©ç›¤ä¸­ï¼ˆé–‹ç›¤å¾Œä»»æ„æ™‚é–“ï¼‰
      
      # Step 3: åŸ·è¡Œ daily_ops_ç›¤ä¸­ (äº’å‹•é¸å–è¦ç”¨çš„å›æ¸¬)
      python daily_ops_v4_intraday_fixed_lstm.py -i
      
      é€™æœƒï¼š
      æŠ“å–ç›¤ä¸­å³æ™‚åƒ¹æ ¼
      ç”¨ç›¸åŒçš„å›ºå®š LSTM è¨ˆç®—é æ¸¬
      é¡¯ç¤ºæ¯ç­† AI æŒå€‰çš„å³æ™‚å ±é…¬ç‡
      å‘Šè¨´ä½ ä»Šå¤©æ˜¯å¦æ‡‰è©²è²·/è³£

      Fixed LSTM ç›¤ä¸­è…³æœ¬ä¿ç•™äº†å®Œå…¨ç›¸åŒçš„åŠŸèƒ½ï¼š
      # æ–¹å¼ 1: äº’å‹•å¼é¸æ“‡ (ç”¨æ–¹å‘éµ)
      python daily_ops_v4_intraday_fixed_lstm.py -i
      # æ–¹å¼ 2: æŒ‡å®šå›æ¸¬èµ·å§‹æ—¥
      python daily_ops_v4_intraday_fixed_lstm.py --backtest-start 2025-12-09
      # æ–¹å¼ 3: ä½¿ç”¨æœ€æ–° (é è¨­)
      python daily_ops_v4_intraday_fixed_lstm.py

      NOTE: âœ… å·²å¯¦ä½œï¼ç¾åœ¨ daily_ops_v4_intraday_fixed_lstm.py æœƒè‡ªå‹•åŒ¹é…å°æ‡‰çš„ LSTM æ¨¡å‹ï¼šé¸æ“‡å“ªå€‹ CSVï¼Œå°±æœƒè‡ªå‹•è¼‰å…¥å°æ‡‰æ—¥æœŸçš„ Fixed LSTM æ¨¡å‹ï¼é€™æ¨£ä½ å¯ä»¥ä¸¦è¡Œæ¸¬è©¦ä¸åŒæ™‚æœŸçš„ç­–ç•¥ï¼Œæ¯å€‹éƒ½ä½¿ç”¨å„è‡ªæœ€é©åˆçš„æ¨¡å‹ã€‚



  